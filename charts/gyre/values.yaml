# Default values for gyre
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1 # SQLite requires single replica

image:
  repository: ghcr.io/entropy0120/gyre
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ''

imagePullSecrets: []
nameOverride: ''
fullnameOverride: ''

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ''

podAnnotations: {}
podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false # Required for SQLite

service:
  type: ClusterIP
  port: 80
  targetPort: 3000
  # nodePort: 30000  # Only used when type is NodePort

ingress:
  enabled: false
  className: ''
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: gyre.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: gyre-tls
  #    hosts:
  #      - gyre.local

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

livenessProbe:
  httpGet:
    path: /api/flux/health
    port: 3000
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/flux/health
    port: 3000
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

persistence:
  enabled: true
  # storageClass: ""  # Use cluster default if not specified
  accessMode: ReadWriteOnce
  size: 1Gi
  annotations: {}
  # existingClaim: ""  # Use an existing PVC if specified

nodeSelector: {}

tolerations: []

affinity: {}

# RBAC configuration
rbac:
  # Create ClusterRole and ClusterRoleBinding for FluxCD resource access
  create: true
  clusterRole:
    # Create cluster-wide role (required for multi-namespace FluxCD monitoring)
    create: true
    # Additional rules to append (optional)
    rules: []

# Admin user configuration
admin:
  # Auto-generate initial admin password in Kubernetes secret
  autoGenerate: true
  # Name of the secret containing the initial admin password
  secretName: gyre-initial-admin-secret

# Encryption configuration
# Keys must be 64-character hexadecimal strings (32 bytes)
# Generate with: openssl rand -hex 32
encryption:
  # Key for encrypting cluster kubeconfigs
  # It is HIGHLY recommended to provide this via an existing secret in production
  gyreKey: ""
  # Key for encrypting OAuth client secrets
  # It is HIGHLY recommended to provide this via an existing secret in production
  authKey: ""
  # Existing secret name containing encryption keys
  # Keys in secret should be named GYRE_ENCRYPTION_KEY and AUTH_ENCRYPTION_KEY
  existingSecret: ""

# Authentication configuration
auth:
  # Enable/disable local username+password login
  localLoginEnabled: true
  # Allow new user registration via OAuth (if false, only existing users can log in)
  allowSignup: true
  # Restrict OAuth signup to specific email domains (empty = allow all)
  domainAllowlist: []
  # OAuth/OIDC providers to seed on startup
  # These are created if they don't exist, but won't overwrite admin UI changes
  providers: []
  # Example providers:
  # providers:
  #   - name: "GitHub"
  #     type: "oauth2-github"
  #     clientId: "your-client-id"
  #     clientSecret: "your-client-secret"  # Will be encrypted at rest
  #     enabled: true
  #     autoProvision: true
  #     defaultRole: "viewer"
  #   - name: "Google"
  #     type: "oauth2-google"
  #     clientId: "your-client-id"
  #     clientSecret: "your-client-secret"
  #     enabled: true
  #     autoProvision: true
  #     defaultRole: "viewer"
  #   - name: "Corporate SSO"
  #     type: "oidc"
  #     clientId: "your-client-id"
  #     clientSecret: "your-client-secret"
  #     issuerUrl: "https://idp.company.com"
  #     enabled: true
  #     autoProvision: true
  #     defaultRole: "viewer"
  #     scopes: "openid profile email groups"
  #     roleClaim: "groups"
  #     roleMapping: '{"admin":["DevOps"],"editor":["Developers"]}'
  # Provider secrets from existing Kubernetes Secret (recommended for production)
  # If set, clientSecret values in providers[] are ignored
  # Secret should have keys like: PROVIDER_0_CLIENT_SECRET, PROVIDER_1_CLIENT_SECRET, etc.
  providersExistingSecret: ""
# Metrics and Monitoring
metrics:
  enabled: true
  serviceMonitor:
    enabled: false
    interval: 30s
    path: /metrics
    # additionalLabels:
    #   release: prometheus
